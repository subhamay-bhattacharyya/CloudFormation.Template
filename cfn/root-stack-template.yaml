AWSTemplateFormatVersion: '2010-09-09'
Description: "Project Name: Stack Description."

Metadata:
  TemplateName: root-stack.yaml
  TemplateType: Root Stack Template for <Service Names>
  Version: 1.0.0
  Owner: Subhamay Bhattacharyya
  ProjectName:  Project Name
  Modification History:
    - 1.0.0 - Jan 31, 2025 -- Initial Version
  StepsToTest: Manually verify the Stack.
  StepsToCleanup: Stack delete command
  AWS::CloudFormation::Interface:
    ParameterGroups:
      ################################## Project Name and Environment ##############################
      - Label:
          default: 'Project Name and Environment:'
        Parameters:
          - ProjectName
          - Environment
      ################################## GitHub Attributes #########################################
      - Label:
          default: 'GitHub Attributes:'
        Parameters:
          - GitHubRef
          - GitHubURL
          - GitHubWFRunNumber
          - GitHubSHA
          - GitHubRepository
          - CiBuild
      ################################## Code Repository ###########################################
      - Label:
          default: 'Code Repository:'
        Parameters:
          - CodeRepositoryS3Bucket
      ################################## KMS #######################################################
      - Label:
          default: "KMS Key:"
        Parameters:
          - KmsMasterKeyAlias
          - KmsMasterKeyArn
    ParameterLabels:
      ################################## Project Name and Environment ##############################
      ProjectName:
        default: "Name of the Project."
      Environment:
        default: "Name of the Deployment Environment."
      ################################## GitHub Attributes #########################################
      GitHubRef:
        default: "GitHub Reference Branch or Tag."
      GitHubURL:
        default: "URL of the GitHub Repository."
      GitHubWFRunNumber:
        default: "GitHub Workflow Execution Run Number."
      GitHubSHA:
        default: "GitHub Commit SHA."
      GitHubRepository:
        default: "Name of the GitHub Repository."
      CiBuild:
        default: "Continuous Integration Build Identifier."
      ################################## Code Repository Bucket ####################################
      CodeRepositoryS3Bucket:
        default: S3 Bucket where the nested stack templates are available.
      ################################## KMS #######################################################
      KmsMasterKeyAlias:
        default: "KMS Master Key Alias."
      KmsMasterKeyArn:
        default: "KMS Master Key Arn."
Parameters:
  ###################################### Project Name and Environment ##############################
  ProjectName:
    Default: serverless-lab-01
    Description: The Project name to be used as a resource tag value.
    Type: String
    MinLength: "5"
    MaxLength: "30"
    AllowedPattern: ^[a-z0-9-]+$
    ConstraintDescription: The length should be between 5 and 30, must contain only
      lowercase alphabets, numbers, or dashes.

  Environment:
    Default: devl
    Description: The Environment name to be used as a resource tag value.
    Type: String
    AllowedValues:
      - devl
      - test
      - prod
    ConstraintDescription: The Environment must be devl / test or prod
  ###################################### GitHub Attributes #########################################
  GitHubRef:
    Default: ref_name
    Description: GitHub Ref name to be used as a resource tag value.
    Type: String
    AllowedPattern: ^[a-zA-Z0-9/_-]+$
    ConstraintDescription: The GitHub Ref Name can only contain alphanumeric
      characters, slashes, underscores, and hyphens.

  GitHubURL:
    Default: https://github.com/subhamay-bhattacharyya/0301-serverless-py-cft
    Description: GitHub URL to be used as a resource tag value.
    Type: String
    AllowedPattern: ^https://github.com/[a-zA-Z0-9._-]+/[a-zA-Z0-9._-]+/?$
    ConstraintDescription: The GitHub URL must start with 'https://github.com/' and
      can only contain alphanumeric characters, dots, underscores, and hyphens.

  GitHubWFRunNumber:
    Default: "1"
    Description: The Workflow run number to be used as a resource tag value.
    Type: Number

  GitHubSHA:
    Default: d3b07384d113edec49eaa6238ad5ff00f6fb3796
    Description: The sha value of the last commit to be used as a resource tag value.
    Type: String
    AllowedPattern: ^[a-fA-F0-9]{40}$
    ConstraintDescription: The SHA value must be a 40-character hexadecimal string.

  GitHubRepository:
    Default: 0301-serverless-py-cft
    Description: The GitHub Repository name to be used as a resource tag value.
    Type: String
    MinLength: "10"
    MaxLength: "30"
    AllowedPattern: ^\d{4}-[a-z]+(-[a-z]+)*$
    ConstraintDescription: The repository length should be between 10 and 30, must
      contain only lowercase letters, numbers, dashes, dots, and should start
      with a letter.

  CiBuild:
    Default: ''
    Description: Ci Build of the feature branch to be appended to a resource name.
    Type: String
  ###################################### Code Repository ###########################################
  CodeRepositoryS3Bucket:
    Default: subhamay-aws-cfn-nested-stack-templates-us-east-1
    Description: S3 Bucket for the nested stack templates.
    Type: String
    AllowedPattern: ^[a-z0-9.-]{3,63}$
    ConstraintDescription: The S3 bucket name must be between 3 and 63 characters
      long, and can only contain lowercase letters, numbers, dots, and hyphens.

  ###################################### KMS #######################################################
  KmsMasterKeyAlias:
    Default: "SB-KMS"
    Description: "The KMS master key alias to be used for server-side encryption."
    Type: String
    MinLength: "5"
    MaxLength: "20"
    AllowedPattern: "^[a-z0-9-]+$"
    ConstraintDescription: "The length of the KMS Key Alias should be between 5 and 20 and can only contain lowercase alphanumeric characters and dashes."
  KmsMasterKeyArn:
    Default: "arn:aws:kms:us-east-1:637423502513:key/494509e4-3bc5-44b8-9c4d-12449900d395"
    Description: "The KMS master key ARN to be used for server-side encryption."
    Type: String
    AllowedPattern: "^$|^arn:aws:kms:[a-z0-9-]+:[0-9]{12}:key/[a-zA-Z0-9-]+$"
    ConstraintDescription: "The ARN must be a valid KMS key ARN."

Resources:
  ###################################### Resources ###############################################
  # S3Bucket:
  #   Type: AWS::S3::Bucket
  #   Properties: {}
Outputs:
  ###################################### Outputs #################################################